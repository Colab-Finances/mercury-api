version: "3.8"

services:
  planner:
    build:
      context: ./ # We need run this from the root of the project
      dockerfile: ./docker/planner/test/react/Dockerfile
      cache_from:
        - type=gha
      cache_to:
        - type=gha,mode=max

  planner_api:
    dns:
      - 8.8.8.8
    build:
      context: ./ # We need run this from the root of the project
      dockerfile: ./docker/planner/test/fastapi/Dockerfile
      cache_from:
        - type=gha
      cache_to:
        - type=gha,mode=max

    env_file:
      - backend/.env.test
    depends_on:
      - database
      - document_db

  database:
    image: postgres:15
    env_file:
      - backend/.env.test

  document_db:
    image: mongo:7
    env_file:
      - backend/.env.test
    environment:
      - MONGO_INITDB_ROOT_USERNAME=mongo
      - MONGO_INITDB_ROOT_PASSWORD=mongo
